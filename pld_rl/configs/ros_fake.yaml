# Stage 1: Residual RL Training Configuration (ROS fake pipeline)
# This config is used by scripts/train_residual_stage1.py

# === Base Policy ===
base_policy_path: "./outputs/pi05_base_sft"
base_chunk_size: 50
base_n_action_steps: 10  # Match lerobot-eval default (not 50!)

# === Environment ===
env_name: "ros_fake"
task_id: 6
env_max_steps: 500
action_dim: 7
state_dim: 8  # pos:3 + axis_angle:3 + gripper:2 (lerobot convention)

# === ROS Fake ===
ros_image_topics:
  - "/gripper/camera/color/image_raw"
  - "/overall/camera/color/image_raw"
  - "/gripper/camera_fisheye/color/image_raw"
ros_joint_topics:
  - "/joint_states_gripper"
  - "/joint_states_single_gripper"
ros_action_topic: "/residual_action"
ros_obs_timeout_s: 0.5
ros_spin_timeout_s: 0.05
ros_fixed_reward: 0.0
ros_task_text: ""
ros_state_source: "position"
ros_image_size: 128
ros_use_cv_bridge: false
ros_fake_random_offline: true
ros_fake_offline_transitions: 1024

# === Residual Policy ===
residual_hidden_dims:
  - 256
  - 256
  - 256
residual_std_min: 1.0e-5
residual_std_max: 1.0

# === Critic ===
critic_hidden_dims:
  - 256
  - 256
  - 256
num_critics: 2

# === RL Hyperparameters ===
discount: 0.99
tau: 0.005
actor_lr: 3.0e-4
critic_lr: 3.0e-4
temperature_init: 1.0
log_alpha_min: -6.9
target_entropy: 4.0
grad_clip_norm: 1.0
residual_penalty_weight: 0.001

# === Residual Scale Schedule ===
xi_init: 0.1
xi_final: 0.1
xi_warmup_episodes: 400

# === Buffer ===
offline_buffer_capacity: 50000
online_buffer_capacity: 200000
batch_size: 256

# === Training ===
warmup_episodes: 1
probe_max_steps: 0
critic_actor_update_ratio: 2
calql_pretrain_steps: 0
calql_num_policy_actions: 10
calql_alpha: 1.0
calql_lse_beta: 1.0
calql_td_xi: 0.0
calql_conservative_xi: 0.05
max_episodes: 1000
eval_freq: 50
eval_probe_max_steps: 0
eval_num_episodes: 30
save_freq: 100
log_freq: 10

# === Encoder ===
use_latent_encoder: true
latent_dim: 256
freeze_encoder: true
encoder_type: "serl_resnet10"
serl_resnet10_weights: "/home/yu_zhang/lerobot/resnet10_params.pkl"
serl_resnet10_image_size: 128
serl_resnet10_num_spatial_blocks: 8
serl_resnet10_auto_download: false
serl_resnet10_log_keys: false

# === PI05 Specific ===
tokenizer_max_length: 200

# === Output ===
output_dir: "./outputs/pld_rl_ros_fake"
log_file: "train.log"
log_mode: "w"
buffer_cache_dir: null
seed: 42
device: "cuda"
